#!/usr/bin/env ruby
require 'thor'
require 'colorize'
require 'what_now'

class Wnow < Thor
  default_task :find

  desc 'find', 'search files in directory for todo elements (default command)'
  option :dir, aliases: '-d'
  option :ext, aliases: '-e'
  option :ignorecase, aliases: '-i'
  def find
    dir = options[:dir] || Dir.pwd
    ext = options[:ext] ? "/**/*.#{options[:ext]}" : '/**/*.*'
    creator = TodoCreator.new(
      ignorecase: options[:ignorecase],
      pretty: STDOUT.tty?)
    TodoFinder.new(dir + ext, creator).find.each do |todo|
      # printable_path = options[:dir] ? t.path : t.path[Dir.pwd.length+1..t.path.length]
      puts todo
      puts if STDOUT.tty?
    end
  end
end

Wnow.start(ARGV)
